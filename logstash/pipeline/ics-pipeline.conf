input {
  beats {
    port => 5044
  }
}

filter {
  if [type] == "suricata" {
    if [dest_ip] == "10.100.1.10" {
      mutate {
        add_field => { "asset_name" => "Asherah PLC" }
        add_field => { "asset_criticality" => "critical" }
      }
    }
    
    if [alert] {
      if [alert][severity] == 1 {
        mutate { add_field => { "severity_label" => "critical" } }
      } else if [alert][severity] == 2 {
        mutate { add_field => { "severity_label" => "high" } }
      } else {
        mutate { add_field => { "severity_label" => "medium" } }
      }
      
      if [alert][signature] =~ /Spam/ {
        mutate { add_tag => ["zero_dynamics_attack", "command_spam"] }
      }
      
      if [alert][signature] =~ /ARP/ {
        mutate { add_tag => ["mitm_attack", "arp_spoofing"] }
      }
    }
  }
}

output {
  if [type] == "suricata" and [event_type] == "alert" {
    elasticsearch {
      hosts => ["elasticsearch:9200"]
      index => "ics-alerts-%{+YYYY.MM.dd}"
    }
  }
  
  if "modbus" in [tags] {
    elasticsearch {
      hosts => ["elasticsearch:9200"]
      index => "ics-modbus-%{+YYYY.MM.dd}"
    }
  }
  
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "ics-logs-%{+YYYY.MM.dd}"
  }
}